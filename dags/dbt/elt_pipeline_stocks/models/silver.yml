# dags/dbt/stocks_dbt_project/models/sources.yml
version: 2

sources:
  - name: stocks_silver_layer
    description: |
      Cleaned, casted, and filtered data,
      ready for dimensional modeling.
    schema: stocks # 'stocks' schema in PostgreSQL
    tables:
      - name: weekly_adjusted_stocks
        identifier: weekly_adjusted_stocks # Physical table name in PostgreSQL
        columns:
          - name: stock_key
            description: Unique composite key (Symbol + Timestamp).
            tests:
              - unique
              - not_null
          - name: stock_symbol
            description: Stock ticker symbol of the asset (FK to dim_symbol).
            tests:
              - not_null
          - name: trade_date
            description: Weekly closing date (DATE type).
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: date
          - name: adjusted_close_price
            description: Adjusted closing price (main metric).
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_positive
              - dbt_expectations.expect_column_max_to_be_less_than:
                  max_value: 10000.00 # Assuming a realistic maximum

          - name: trade_volume
            description: Weekly transaction volume.
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_of_type:
                  column_type: integer
